<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·´ç‰¹ä¸€å®¶çš„æ–°ç”Ÿæ´» - K3 ä¸­æ–‡å­¸ç¿’</title>
    <!-- å¼•å…¥ Tailwind CSS å¿«é€Ÿæ¨£å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts: Zen Maru Gothic (æ—¥å¼åœ“é«”é¢¨æ ¼) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sakura': '#fde2e4',
                        'matcha': '#dbe7c9',
                        'sky': '#dbebf7',
                        'lemon': '#fff4bd',
                        'coffee': '#8d6e63',
                        'cream': '#fdfbf7',
                    },
                    fontFamily: {
                        'cute': ['"Zen Maru Gothic"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* éš±è—åœ–ç‰‡æ¨¡å¼ */
        .hide-images .emoji-img {
            display: none;
        }
        
        /* å‹•ç•« */
        .bounce-hover:hover {
            transform: scale(1.05);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* éŠæˆ²æ­£ç¢ºéŒ¯èª¤å‹•ç•« */
        .correct-anim {
            animation: bounce 0.5s;
            background-color: #dbe7c9 !important;
        }
        .wrong-anim {
            animation: shake 0.5s;
            background-color: #fde2e4 !important;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* æ–‡å­—å¤§å°å‹•æ…‹èª¿æ•´ */
        .text-size-sm { font-size: 1rem; }
        .text-size-md { font-size: 1.5rem; }
        .text-size-lg { font-size: 2.2rem; }
        .text-size-xl { font-size: 3rem; }
    </style>
</head>
<body class="text-gray-700 h-screen flex flex-col overflow-hidden">

    <!-- é ‚éƒ¨å°èˆª -->
    <header class="bg-white shadow-sm p-4 flex justify-between items-center z-10">
        <div class="flex items-center gap-3">
            <div class="bg-sakura p-2 rounded-full text-2xl">ğŸ«</div>
            <h1 class="text-xl md:text-2xl font-bold text-coffee">K3 å¿«æ¨‚å­¸ä¸­æ–‡</h1>
        </div>
        <button onclick="toggleSettings()" class="bg-matcha text-coffee px-4 py-2 rounded-full font-bold hover:bg-green-200 transition shadow-sm flex items-center gap-2">
            âš™ï¸ è¨­å®š
        </button>
    </header>

    <!-- è¨­å®šé¢æ¿ (Modal) -->
    <div id="settingsPanel" class="fixed inset-0 bg-black bg-opacity-30 hidden z-50 flex justify-center items-center">
        <div class="bg-white p-6 rounded-3xl shadow-xl w-11/12 max-w-md border-4 border-lemon">
            <h2 class="text-2xl font-bold text-center mb-6 text-coffee">âš™ï¸ è¨­å®š</h2>
            
            <div class="mb-6">
                <label class="block text-lg font-bold mb-2">æ–‡å­—å¤§å°</label>
                <input type="range" min="1" max="3" value="2" class="w-full accent-coffee" id="sizeSlider" oninput="updateSize()">
                <div class="flex justify-between text-sm text-gray-500 mt-1">
                    <span>å°</span>
                    <span>ä¸­</span>
                    <span>å¤§</span>
                </div>
            </div>

            <div class="mb-6 flex justify-between items-center">
                <label class="text-lg font-bold">é¡¯ç¤ºåœ–ç‰‡ (åœ–ç¤º)</label>
                <button id="imgToggleBtn" onclick="toggleImages()" class="w-14 h-8 bg-green-400 rounded-full relative transition-colors duration-200">
                    <div id="imgToggleCircle" class="w-6 h-6 bg-white rounded-full absolute top-1 left-7 shadow-sm transition-all duration-200"></div>
                </button>
            </div>

            <button onclick="toggleSettings()" class="w-full bg-sakura text-coffee font-bold py-3 rounded-xl hover:bg-pink-200 transition">
                å®Œæˆ
            </button>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main id="appContent" class="flex-1 overflow-y-auto p-4 md:p-8 relative">
        <!-- å…§å®¹ç”± JS å‹•æ…‹æ¸²æŸ“ -->
    </main>

    <!-- åº•éƒ¨å°èˆª -->
    <nav class="bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] p-3">
        <div class="max-w-3xl mx-auto flex justify-around">
            <button onclick="setMode('home')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-coffee transition">
                <span class="text-2xl">ğŸ </span>
                <span class="text-xs font-bold">ä¸»é </span>
            </button>
            <button onclick="setMode('learn')" class="nav-btn flex flex-col items-center gap-1 text-coffee transition">
                <span class="text-2xl">ğŸ“–</span>
                <span class="text-xs font-bold">å­¸ç¿’æ¨¡å¼</span>
            </button>
            <button onclick="setMode('game')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-coffee transition">
                <span class="text-2xl">ğŸ®</span>
                <span class="text-xs font-bold">éŠæˆ²æ¨¡å¼</span>
            </button>
        </div>
    </nav>

    <script>
        // --- è³‡æ–™åº« ---
        const vocabData = [
            { text: "æ—…è¡Œ", emoji: "âœˆï¸", pinyin: "leoi5 hang4" }, { text: "é™Œç”Ÿ", emoji: "â“", pinyin: "mak6 sang1" },
            { text: "æ­¡è¿", emoji: "ğŸ‘", pinyin: "fun1 jing4" }, { text: "å‹å–„", emoji: "ğŸ¤", pinyin: "jau5 sin6" },
            { text: "é„°å±…", emoji: "ğŸ¡", pinyin: "leon4 geoi1" }, { text: "å›°é›£", emoji: "ğŸ˜“", pinyin: "kwan3 naan4" },
            { text: "è¨­æ–½", emoji: "ğŸ—ï¸", pinyin: "cit3 si1" }, { text: "è¼ªæ¤…", emoji: "ğŸ¦½", pinyin: "leon4 ji2" },
            { text: "æ¨‚å™¨", emoji: "ğŸ»", pinyin: "ngok6 hei3" }, { text: "é‚€è«‹", emoji: "ğŸ’Œ", pinyin: "jiu1 cing2" },
            { text: "ç±Œæ¬¾", emoji: "ğŸ’°", pinyin: "cau4 fun2" }, { text: "æ°´ç½", emoji: "ğŸŒŠ", pinyin: "seoi2 zoi1" },
            { text: "éŸ³æ¨‚", emoji: "ğŸµ", pinyin: "jam1 ngok6" }, { text: "ç¤¾å€", emoji: "ğŸ˜ï¸", pinyin: "se5 keoi1" },
            { text: "æ›¸ç±", emoji: "ğŸ“š", pinyin: "syu1 zik6" }, { text: "èŒ¶æ¨“", emoji: "ğŸµ", pinyin: "caa4 lau4" },
            { text: "é†«é™¢", emoji: "ğŸ¥", pinyin: "ji1 jyun2" }, { text: "é ’ç", emoji: "ğŸ†", pinyin: "baan1 zoeng2" },
            { text: "æ¢è¨ª", emoji: "ğŸ‘µ", pinyin: "taam3 fong2" }, { text: "è³£æ——", emoji: "ğŸ³ï¸", pinyin: "maai6 kei4" },
            { text: "æ–°å¹´", emoji: "ğŸ§§", pinyin: "san1 nin4" }, { text: "æ˜¥ç¯€", emoji: "ğŸ®", pinyin: "ceon1 zit3" },
            { text: "åœ–æ›¸é¤¨", emoji: "ğŸ«", pinyin: "tou4 syu1 gun2" }, { text: "éƒµæ”¿å±€", emoji: "ğŸ“®", pinyin: "jau4 zing3 guk6" },
            { text: "ä¾¿åˆ©åº—", emoji: "ğŸª", pinyin: "bin6 lei6 dim3" }, { text: "åƒåœ¾ç®±", emoji: "ğŸ—‘ï¸", pinyin: "laap6 saap3 soeng1" },
            { text: "äº¤é€šç‡ˆ", emoji: "ğŸš¦", pinyin: "gaau1 tung1 dang1" }, { text: "è¶…ç´šå¸‚å ´", emoji: "ğŸ›’", pinyin: "ciu1 kap1 si5 coeng4" },
            { text: "éƒŠé‡å…¬åœ’", emoji: "ğŸŒ³", pinyin: "gaau1 je5 gung1 jyun2" }
        ];

        const sentenceData = [
            "æˆ‘å€‘æ˜¯å¥½æœ‹å‹ã€‚",
            "æˆ‘å–œæ­¡åˆ°å…¬åœ’ç©ã€‚",
            "ä¸–ç•Œå„åœ°æœ‰å¾ˆå¤šä¸åŒçš„ç¾é£Ÿã€‚",
            "è¡Œäººå¤©æ©‹æ˜¯ç¤¾å€è¨­æ–½ã€‚",
            "æˆ‘æœƒåƒåŠ ç¤¾å€çš„æ¸…æ½”æ´»å‹•ã€‚",
            "æˆ‘å€‘æœƒå¹«åŠ©æœ‰éœ€è¦çš„äººã€‚"
        ];

        const wordCombos = [
            { key: "æ¨‚", words: ["å¿«æ¨‚", "æ¨‚è¶£", "æ¨‚æ›²", "æ¨‚åœ’", "æ¨‚è­œ"], color: "bg-sakura" },
            { key: "ç‰¹", words: ["ç‰¹åˆ¥", "ç‰¹å¾µ", "ç‰¹è‰²", "ç‰¹ç”¢", "ç‰¹é»"], color: "bg-matcha" },
            { key: "è¡Œ", words: ["æ—…è¡Œ", "è¡Œå‹•", "è¡Œç¨‹", "è¡Œæ", "è¡Œæ¥­"], color: "bg-sky" },
            { key: "æ¸…", words: ["æ¸…æ¥š", "æ¸…æ™¨", "æ¸…ç†", "æ¸…ç™½", "æ¸…æ·¡"], color: "bg-lemon" },
            { key: "è«‹", words: ["è«‹æ•™", "è«‹å‡", "è«‹å•", "è«‹æ±‚", "è«‹å®¢"], color: "bg-sakura" },
            { key: "èŒ¶", words: ["èŒ¶è‘‰", "èŒ¶æœƒ", "èŒ¶å…·", "èŒ¶æ¯", "èŒ¶åœ’"], color: "bg-matcha" },
            { key: "é›£", words: ["é›£é¡Œ", "é›£å¾—", "é›£åº¦", "é›£é", "é›£é—œ"], color: "bg-sky" },
            { key: "å–„", words: ["å–„è‰¯", "å–„äº‹", "å–„å ±", "å–„å¿˜", "å–„è®Š"], color: "bg-lemon" }
        ];

        const antonyms = [
            { w1: "é«˜", w2: "çŸ®", e1: "ğŸ¦’", e2: "ğŸ" },
            { w1: "èƒ–", w2: "ç˜¦", e1: "ğŸ˜", e2: "ğŸ¦Œ" },
            { w1: "å¤§", w2: "å°", e1: "ğŸ‰", e2: "ğŸ‡" },
            { w1: "ä¸Š", w2: "ä¸‹", e1: "ğŸ‘†", e2: "ğŸ‘‡" },
            { w1: "é«˜", w2: "ä½", e1: "ğŸ”ï¸", e2: "ğŸœï¸" },
            { w1: "é ", w2: "è¿‘", e1: "ğŸ”­", e2: "ğŸ‘“" },
            { w1: "åš", w2: "è–„", e1: "ğŸ“š", e2: "ğŸ“„" },
            { w1: "å†·", w2: "ç†±", e1: "â„ï¸", e2: "ğŸ”¥" },
            { w1: "å·¦", w2: "å³", e1: "â¬…ï¸", e2: "â¡ï¸" },
            { w1: "å¿«", w2: "æ…¢", e1: "ğŸ‡", e2: "ğŸ¢" },
            { w1: "å¤š", w2: "å°‘", e1: "ğŸ”¢", e2: "1ï¸âƒ£" },
            { w1: "è£", w2: "å¤–", e1: "ğŸ“¥", e2: "ğŸ“¤" },
            { w1: "è¼•", w2: "é‡", e1: "ğŸˆ", e2: "ğŸ‹ï¸" },
            { w1: "å‰", w2: "å¾Œ", e1: "â©", e2: "âª" },
            { w1: "é•·", w2: "çŸ­", e1: "ğŸ“", e2: "ğŸ¤" }
        ];

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let currentMode = 'home';
        let learnTab = 'vocab'; // vocab, sentence, combos, antonyms
        let textSizeLevel = 2; // 1=sm, 2=md, 3=lg
        let showImages = true;

        // --- TTS èªéŸ³åŠŸèƒ½ ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€å€‹ç™¼éŸ³
                const utterance = new SpeechSynthesisUtterance(text);
                
                // å˜—è©¦å°‹æ‰¾å»£æ±è©±èªéŸ³ (zh-HK)
                const voices = window.speechSynthesis.getVoices();
                const cantoneseVoice = voices.find(voice => voice.lang === 'zh-HK');
                
                if (cantoneseVoice) {
                    utterance.voice = cantoneseVoice;
                }
                utterance.lang = 'zh-HK';
                utterance.rate = 0.8; // å°æœ‹å‹é©åˆæ…¢ä¸€é»
                utterance.pitch = 1.1; // é«˜ä¸€é»æ¯”è¼ƒè¦ªåˆ‡
                
                window.speechSynthesis.speak(utterance);
            } else {
                alert("ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åŠŸèƒ½ã€‚");
            }
        }

        // --- ä»‹é¢æ¸²æŸ“é‚è¼¯ ---

        function init() {
            setMode('home');
            // é è¼‰èªéŸ³åˆ—è¡¨ (æŸäº›ç€è¦½å™¨éœ€è¦)
            window.speechSynthesis.getVoices();
        }

        function setMode(mode) {
            currentMode = mode;
            updateNavStyles();
            const content = document.getElementById('appContent');
            content.innerHTML = '';
            content.className = `flex-1 overflow-y-auto p-4 md:p-8 relative fade-in ${showImages ? '' : 'hide-images'}`;
            
            if (mode === 'home') renderHome(content);
            else if (mode === 'learn') renderLearn(content);
            else if (mode === 'game') renderGame(content);
        }

        function renderHome(container) {
            container.innerHTML = `
                <div class="h-full flex flex-col justify-center items-center gap-8">
                    <div class="text-center">
                        <div class="text-6xl mb-4 bounce-hover cursor-default">ğŸ«</div>
                        <h2 class="text-3xl font-bold text-coffee mb-2">å·´ç‰¹ä¸€å®¶çš„æ–°ç”Ÿæ´»</h2>
                        <p class="text-gray-500">K3 ä¸­æ–‡äº’å‹•å­¸ç¿’å¹³å°</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-lg">
                        <button onclick="setMode('learn')" class="bg-white p-6 rounded-3xl shadow-lg border-b-8 border-sakura hover:translate-y-1 active:translate-y-2 active:border-b-0 transition-all flex items-center gap-4 group">
                            <span class="text-4xl group-hover:scale-110 transition">ğŸ“–</span>
                            <div class="text-left">
                                <h3 class="text-xl font-bold text-gray-700">å­¸ç¿’æ¨¡å¼</h3>
                                <p class="text-sm text-gray-400">èªå­—ã€å¥å­ã€é…è©</p>
                            </div>
                        </button>
                        <button onclick="setMode('game')" class="bg-white p-6 rounded-3xl shadow-lg border-b-8 border-matcha hover:translate-y-1 active:translate-y-2 active:border-b-0 transition-all flex items-center gap-4 group">
                            <span class="text-4xl group-hover:scale-110 transition">ğŸ®</span>
                            <div class="text-left">
                                <h3 class="text-xl font-bold text-gray-700">éŠæˆ²æ¨¡å¼</h3>
                                <p class="text-sm text-gray-400">è½è²éŸ³æ‰¾ç­”æ¡ˆ</p>
                            </div>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderLearn(container) {
            // å­¸ç¿’æ¨¡å¼çš„å­å°èˆª
            const tabsHTML = `
                <div class="flex flex-wrap gap-2 mb-6 justify-center">
                    <button onclick="switchLearnTab('vocab')" class="${learnTab === 'vocab' ? 'bg-coffee text-white' : 'bg-white text-coffee'} px-4 py-2 rounded-full font-bold shadow-sm transition">èªè®€ç”Ÿå­—</button>
                    <button onclick="switchLearnTab('sentence')" class="${learnTab === 'sentence' ? 'bg-coffee text-white' : 'bg-white text-coffee'} px-4 py-2 rounded-full font-bold shadow-sm transition">å¥å­æœ—è®€</button>
                    <button onclick="switchLearnTab('combos')" class="${learnTab === 'combos' ? 'bg-coffee text-white' : 'bg-white text-coffee'} px-4 py-2 rounded-full font-bold shadow-sm transition">é…è©ç·´ç¿’</button>
                    <button onclick="switchLearnTab('antonyms')" class="${learnTab === 'antonyms' ? 'bg-coffee text-white' : 'bg-white text-coffee'} px-4 py-2 rounded-full font-bold shadow-sm transition">ç›¸åè©</button>
                </div>
                <div id="learnContent" class="pb-10"></div>
            `;
            container.innerHTML = tabsHTML;
            renderLearnContent();
        }

        function switchLearnTab(tab) {
            learnTab = tab;
            setMode('learn'); // Re-render
        }

        function renderLearnContent() {
            const container = document.getElementById('learnContent');
            const textSizeClass = getTextSizeClass();

            if (learnTab === 'vocab') {
                let html = '<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">';
                vocabData.forEach(item => {
                    html += `
                        <div onclick="speak('${item.text}')" class="bg-white rounded-2xl p-4 shadow-md flex flex-col items-center justify-center cursor-pointer hover:shadow-lg hover:-translate-y-1 transition border-2 border-transparent hover:border-sakura">
                            <span class="text-5xl mb-2 emoji-img">${item.emoji}</span>
                            <span class="${textSizeClass} font-bold text-gray-700">${item.text}</span>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;

            } else if (learnTab === 'sentence') {
                let html = '<div class="space-y-4 max-w-2xl mx-auto">';
                sentenceData.forEach((sent, index) => {
                    // Highlight logic simple: underline specific words from prompt
                    let displaySent = sent
                        .replace("å¥½æœ‹å‹", "<u class='decoration-wavy decoration-sakura'>å¥½æœ‹å‹</u>")
                        .replace("å…¬åœ’", "<u class='decoration-wavy decoration-matcha'>å…¬åœ’</u>")
                        .replace("ç¾é£Ÿ", "<u class='decoration-wavy decoration-lemon'>ç¾é£Ÿ</u>")
                        .replace("è¡Œäººå¤©æ©‹", "<u class='decoration-wavy decoration-sky'>è¡Œäººå¤©æ©‹</u>")
                        .replace("æ¸…æ½”æ´»å‹•", "<u class='decoration-wavy decoration-sakura'>æ¸…æ½”æ´»å‹•</u>");

                    html += `
                        <div onclick="speak('${sent.replace(/<[^>]*>/g, '')}')" class="bg-white rounded-2xl p-6 shadow-md cursor-pointer hover:bg-sky transition border-l-8 border-sky flex gap-4 items-center">
                            <span class="bg-sky text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">ğŸ”Š</span>
                            <p class="${textSizeClass} font-bold leading-relaxed text-gray-700">${displaySent}</p>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;

            } else if (learnTab === 'combos') {
                let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
                wordCombos.forEach(group => {
                    html += `
                        <div class="bg-white rounded-3xl shadow-md p-6 relative overflow-hidden">
                            <div class="absolute -right-4 -top-4 w-24 h-24 ${group.color} rounded-full opacity-20"></div>
                            <div class="flex items-center gap-4 mb-4 border-b-2 border-dashed border-gray-100 pb-2">
                                <div onclick="speak('${group.key}')" class="${group.color} w-16 h-16 rounded-full flex items-center justify-center text-3xl font-bold text-gray-700 cursor-pointer shadow-inner">
                                    ${group.key}
                                </div>
                                <span class="text-sm text-gray-400">é»æ“Šæœ—è®€</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                ${group.words.map(w => `
                                    <span onclick="speak('${w}')" class="bg-gray-50 hover:bg-gray-100 border border-gray-200 px-3 py-1 rounded-lg text-lg cursor-pointer transition">
                                        ${w}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;

            } else if (learnTab === 'antonyms') {
                let html = '<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">';
                antonyms.forEach(pair => {
                    html += `
                        <div class="bg-white rounded-2xl p-4 shadow-md flex items-center justify-between px-8 relative overflow-hidden">
                            <div class="absolute inset-x-0 top-1/2 h-0.5 bg-gray-100 -z-0"></div>
                            <div onclick="speak('${pair.w1}')" class="flex flex-col items-center cursor-pointer z-10 bg-white p-2 rounded-xl hover:scale-110 transition">
                                <span class="text-3xl emoji-img mb-1">${pair.e1}</span>
                                <span class="text-xl font-bold text-coffee">${pair.w1}</span>
                            </div>
                            <span class="text-gray-300 font-bold z-10">VS</span>
                            <div onclick="speak('${pair.w2}')" class="flex flex-col items-center cursor-pointer z-10 bg-white p-2 rounded-xl hover:scale-110 transition">
                                <span class="text-3xl emoji-img mb-1">${pair.e2}</span>
                                <span class="text-xl font-bold text-coffee">${pair.w2}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            }
        }

        // --- éŠæˆ²é‚è¼¯ ---
        let currentQuestion = null;
        let isAnswering = false;

        function renderGame(container) {
            container.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center max-w-2xl mx-auto w-full">
                    <div class="mb-8 text-center">
                        <h2 class="text-2xl font-bold text-coffee mb-2">ğŸ‘‚ è½è²éŸ³ï¼Œæ‰¾æœ‹å‹</h2>
                        <p class="text-gray-500">é»æ“Šå–‡å­è½è²éŸ³ï¼Œç„¶å¾Œé¸å‡ºæ­£ç¢ºçš„åœ–ç‰‡æ–‡å­—ï¼</p>
                    </div>

                    <div id="gameArea" class="w-full">
                        <!-- éŠæˆ²å…§å®¹å‹•æ…‹è¼‰å…¥ -->
                    </div>
                </div>
            `;
            newGameQuestion();
        }

        function newGameQuestion() {
            const gameArea = document.getElementById('gameArea');
            isAnswering = false;
            
            // Randomly select one vocab
            const target = vocabData[Math.floor(Math.random() * vocabData.length)];
            currentQuestion = target;

            // Pick 2 distractors (different from target)
            let options = [target];
            while (options.length < 3) {
                let d = vocabData[Math.floor(Math.random() * vocabData.length)];
                if (!options.includes(d)) options.push(d);
            }

            // Shuffle options
            options.sort(() => Math.random() - 0.5);

            // Render
            let html = `
                <div class="flex justify-center mb-8">
                    <button onclick="speak('${target.text}')" class="bg-sakura w-24 h-24 rounded-full flex items-center justify-center shadow-lg hover:scale-105 active:scale-95 transition animate-pulse">
                        <span class="text-5xl">ğŸ”Š</span>
                    </button>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    ${options.map(opt => `
                        <button onclick="checkAnswer(this, '${opt.text}')" class="option-btn bg-white aspect-square rounded-3xl shadow-md border-b-4 border-gray-200 hover:border-matcha hover:-translate-y-1 transition flex flex-col items-center justify-center gap-2 p-2">
                            <span class="text-4xl md:text-6xl emoji-img">${opt.emoji}</span>
                            <span class="text-xl md:text-2xl font-bold text-gray-700">${opt.text}</span>
                        </button>
                    `).join('')}
                </div>
                <div id="feedback" class="text-center mt-6 h-8 font-bold text-xl text-coffee"></div>
            `;
            
            gameArea.innerHTML = html;
            
            // Auto play sound after short delay
            setTimeout(() => speak(target.text), 500);
        }

        function checkAnswer(btn, answerText) {
            if (isAnswering) return;
            isAnswering = true;
            
            const feedback = document.getElementById('feedback');

            if (answerText === currentQuestion.text) {
                // Correct
                btn.classList.add('correct-anim');
                feedback.innerHTML = "âœ¨ ç­”å°äº†ï¼å¥½æ£’ï¼ âœ¨";
                speak("ç­”å°äº†");
                setTimeout(() => {
                    newGameQuestion();
                }, 1500);
            } else {
                // Wrong
                btn.classList.add('wrong-anim');
                feedback.innerHTML = "åŠ æ²¹ï¼Œå†è©¦ä¸€æ¬¡ï¼ğŸ’ª";
                speak("å†è©¦ä¸€æ¬¡");
                setTimeout(() => {
                    btn.classList.remove('wrong-anim');
                    isAnswering = false;
                    feedback.innerHTML = "";
                }, 1000);
            }
        }


        // --- è¨­å®šèˆ‡å·¥å…· ---
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('hidden');
        }

        function updateSize() {
            const slider = document.getElementById('sizeSlider');
            textSizeLevel = parseInt(slider.value);
            
            // If currently in learn mode, re-render to apply class
            if (currentMode === 'learn') {
                renderLearnContent();
            }
        }

        function toggleImages() {
            showImages = !showImages;
            const btn = document.getElementById('imgToggleBtn');
            const circle = document.getElementById('imgToggleCircle');
            const app = document.getElementById('appContent');

            if (showImages) {
                btn.classList.remove('bg-gray-300');
                btn.classList.add('bg-green-400');
                circle.classList.remove('left-1');
                circle.classList.add('left-7');
                app.classList.remove('hide-images');
            } else {
                btn.classList.add('bg-gray-300');
                btn.classList.remove('bg-green-400');
                circle.classList.add('left-1');
                circle.classList.remove('left-7');
                app.classList.add('hide-images');
            }
        }

        function getTextSizeClass() {
            if (textSizeLevel === 1) return 'text-lg';
            if (textSizeLevel === 2) return 'text-2xl';
            if (textSizeLevel === 3) return 'text-4xl';
            return 'text-2xl';
        }

        function updateNavStyles() {
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach((btn, idx) => {
                const modes = ['home', 'learn', 'game'];
                if (modes[idx] === currentMode) {
                    btn.classList.remove('text-gray-400');
                    btn.classList.add('text-coffee');
                } else {
                    btn.classList.add('text-gray-400');
                    btn.classList.remove('text-coffee');
                }
            });
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>